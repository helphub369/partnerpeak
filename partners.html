<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Partners • PartnerPeak</title>
  <link rel="stylesheet" href="assets/style.css">
  <style>
    /* Page-local trims to match the theme without relying on anything else */
    .container{max-width:1100px;margin:0 auto;padding:24px}
    .page-title{font-size:clamp(28px,4vw,40px);font-weight:800;margin:12px 0 8px}
    .muted{opacity:.8}
    .toolbar{display:flex;gap:12px;flex-wrap:wrap;margin:16px 0}
    .toolbar input,.toolbar select{background:#0d1520;border:1px solid #2a3a4a;color:#dbe4ee;
      padding:10px 12px;border-radius:10px;min-width:220px}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{font-size:12px;padding:4px 8px;border-radius:20px;background:#142233;border:1px solid #2a3a4a}
    .chip.ok{background:#0c2a18;border-color:#1f7a3a;color:#c9ffd9}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;margin-top:14px}
    .card{background:#0b1220;border:1px solid #203245;border-radius:14px;padding:16px;display:flex;flex-direction:column;gap:10px}
    .card h3{margin:0;font-size:18px}
    .badges{display:flex;gap:6px;flex-wrap:wrap}
    .badge{background:#132132;border:1px solid #2b4158;color:#cfe6ff;font-size:11px;padding:3px 7px;border-radius:10px}
    .meta{font-size:13px;line-height:1.4}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .row .pill{font-size:11px;background:#121b2c;border:1px solid #24354a;border-radius:999px;padding:3px 8px}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:10px 12px;border-radius:10px;border:1px solid #25405c;background:#0f1a2b;color:#d8e7fb;text-decoration:none;font-weight:600}
    .btn:hover{background:#132036}
    .empty{opacity:.8;padding:24px;border:1px dashed #2b4158;border-radius:12px;text-align:center;margin-top:16px}
    .results-bar{display:flex;justify-content:space-between;align-items:center;margin:12px 0 6px;font-size:13px;opacity:.9}
    .table-note{font-size:12px;opacity:.8;margin-top:8px}
    @media (max-width:700px){.toolbar{flex-direction:column;align-items:stretch}.results-bar{flex-direction:column;gap:6px;align-items:flex-start}}
  </style>
</head>
<body>
  <header class="container" style="padding-top:28px">
    <a href="./" class="btn" style="margin-bottom:10px">← Back to Home</a>
    <h1 class="page-title">Partner Directory</h1>
    <div class="muted">All listings are restricted to <strong>low-risk, automation-friendly</strong> programs. FTC disclosure injected on outbound links.</div>

    <div class="chips" id="summaryChips"></div>

    <div class="toolbar">
      <input id="q" type="search" placeholder="Search by name or description…" />
      <select id="region">
        <option value="">Region: Any</option>
        <option value="US">US-ready</option>
        <option value="EU">EU-ready</option>
        <option value="UK">UK-ready</option>
        <option value="APAC">APAC-ready</option>
      </select>
      <select id="vertical">
        <option value="">Vertical: Any</option>
      </select>
      <select id="payout">
        <option value="">Payout: Any</option>
        <option value="recurring">Recurring</option>
        <option value="one-time">One-time</option>
      </select>
      <select id="friction">
        <option value="">Approval friction: Any</option>
        <option value="light">Light</option>
        <option value="standard">Standard</option>
      </select>
      <select id="sort">
        <option value="score-desc">Sort: Automation score (high→low)</option>
        <option value="name-asc">Sort: Name (A→Z)</option>
      </select>
    </div>
  </header>

  <main class="container">
    <div class="results-bar">
      <div><strong id="count">0</strong> programs</div>
      <div class="table-note">Data source: <code>scripts/partners.data.js</code></div>
    </div>
    <div id="cards" class="grid"></div>
    <div id="empty" class="empty" style="display:none">No partners match your filters.</div>
  </main>

  <script src="scripts/partners.data.js"></script>
  <script>
    // ---- tiny utils --------------------------------------------------------
    const $ = (s)=>document.querySelector(s);
    const el = (t,props={},children=[])=>{const n=document.createElement(t);Object.assign(n,props);children.forEach(c=>n.append(c));return n};
    const uniq = (arr)=>[...new Set(arr)];

    // Guard: expect PARTNER_DATA in window
    const DATA = (window.PARTNER_DATA||[]).map((p,i)=>({
      id:i+1,
      program_name:p.program_name,
      verticals:p.verticals||[],
      mechanism:p.mechanism||"referral link",
      automation_score:Number(p.automation_score||0),
      payout_model:p.payout_model||"one-time",
      typical_payout_range:p.typical_payout_range||"",
      geo_coverage:p.geo_coverage||"global",
      regions_ready:p.regions_ready||inferRegions(p.geo_coverage),
      approval_friction:p.approval_friction||"standard",
      conversion_reporting:p.conversion_reporting||{type:"",docs_url:""},
      deep_link_template:p.deep_link_template||"",
      risk_flags:p.risk_flags||[],
      source_url:p.source_url||"#",
      blurb:p.blurb||""
    }));

    function inferRegions(coverage){
      const c=(coverage||"").toLowerCase();
      if(c.includes("global")) return ["US","EU","UK","APAC"];
      const r=[];
      if(c.includes("us")) r.push("US");
      if(c.includes("eu")) r.push("EU");
      if(c.includes("uk")) r.push("UK");
      if(c.includes("apac")||c.includes("asia")) r.push("APAC");
      return r.length?r:["US"];
    }

    // ---- summary chips (top of page) --------------------------------------
    function renderSummary(){
      const total=DATA.length;
      const cats=uniq(DATA.flatMap(d=>d.verticals)).length;
      const regions={US:0,EU:0,UK:0,APAC:0};
      DATA.forEach(d=>{["US","EU","UK","APAC"].forEach(r=>{ if(d.regions_ready.includes(r)) regions[r]++ })});
      const wrap=$("#summaryChips"); wrap.innerHTML="";
      [
        {t:"Programs",v:total},
        {t:"Categories",v:cats},
        {t:"US-ready",v:regions.US},
        {t:"EU-ready",v:regions.EU},
        {t:"UK-ready",v:regions.UK},
        {t:"APAC-ready",v:regions.APAC},
      ].forEach(x=>{
        wrap.append(el("span",{className:"chip ok",textContent:`${x.v} ${x.t}`}))
      });
    }

    // ---- filters -----------------------------------------------------------
    const state={ q:"", region:"", vertical:"", payout:"", friction:"", sort:"score-desc" };

    function apply(){
      let rows=[...DATA];

      if(state.q){
        const q=state.q.toLowerCase();
        rows=rows.filter(d=>
          d.program_name.toLowerCase().includes(q) ||
          d.verticals.join(" ").toLowerCase().includes(q) ||
          d.blurb.toLowerCase().includes(q)
        );
      }
      if(state.region){
        rows=rows.filter(d=>d.regions_ready.includes(state.region));
      }
      if(state.vertical){
        rows=rows.filter(d=>d.verticals.includes(state.vertical));
      }
      if(state.payout){
        rows=rows.filter(d=>d.payout_model===state.payout);
      }
      if(state.friction){
        rows=rows.filter(d=>d.approval_friction===state.friction);
      }

      if(state.sort==="name-asc"){
        rows.sort((a,b)=>a.program_name.localeCompare(b.program_name));
      }else{
        rows.sort((a,b)=>b.automation_score-a.automation_score || a.program_name.localeCompare(b.program_name));
      }

      render(rows);
    }

    // ---- render cards ------------------------------------------------------
    function buildLink(d){
      // If deep_link_template exists, inject demo tokens; otherwise use source_url
      if(d.deep_link_template && d.deep_link_template.includes("{AFF_ID}")){
        const dest = encodeURIComponent(d.source_url || "https://example.com");
        const click = Math.random().toString(36).slice(2);
        return d.deep_link_template
          .replace("{AFF_ID}","aff_demo")
          .replace("{CLICK_ID}", click)
          .replace("{URLENCODED_DEST}", dest);
      }
      return d.source_url || "#";
    }

    function render(rows){
      $("#count").textContent = rows.length;
      const cards=$("#cards"); cards.innerHTML="";
      $("#empty").style.display = rows.length? "none":"block";

      rows.forEach(d=>{
        const regions = d.regions_ready.map(r=>el("span",{className:"badge",textContent:r}));
        const verts   = d.verticals.map(v=>el("span",{className:"pill",textContent:v}));

        const header = el("div",{},[
          el("h3", { textContent: d.program_name }),
          el("div",{className:"badges"},[
            el("span",{className:"badge",textContent:`Score ${d.automation_score}`}),
            el("span",{className:"badge",textContent:d.payout_model}),
            ...regions
          ])
        ]);

        const meta = el("div",{className:"meta"},[
          el("div",{textContent: d.blurb || "Automation-friendly SaaS partner."}),
          el("div",{className:"row", children: verts}),
          d.typical_payout_range ? el("div",{className:"muted",textContent:`Typical payout: ${d.typical_payout_range}`}) : "",
          el("div",{className:"muted",textContent:`Approval: ${d.approval_friction}`}),
        ].filter(Boolean));

        const ctaRow = el("div",{className:"row"},[
          el("a",{className:"btn",href:buildLink(d),target:"_blank",rel:"noopener",textContent:"Get Link →"}),
          d.conversion_reporting?.docs_url ? el("a",{className:"btn",href:d.conversion_reporting.docs_url,target:"_blank",rel:"noopener",textContent:"Docs"}) : ""
        ].filter(Boolean));

        const card = el("div",{className:"card"},[header, meta, ctaRow]);
        cards.append(card);
      });
    }

    // ---- populate vertical select + hook up events ------------------------
    (function init(){
      // vertical options
      const allVerts = uniq(DATA.flatMap(d=>d.verticals)).sort();
      allVerts.forEach(v=>$("#vertical").append(new Option(v,v)));

      // inputs
      $("#q").addEventListener("input", e=>{state.q=e.target.value.trim();apply()});
      $("#region").addEventListener("change", e=>{state.region=e.target.value;apply()});
      $("#vertical").addEventListener("change", e=>{state.vertical=e.target.value;apply()});
      $("#payout").addEventListener("change", e=>{state.payout=e.target.value;apply()});
      $("#friction").addEventListener("change", e=>{state.friction=e.target.value;apply()});
      $("#sort").addEventListener("change", e=>{state.sort=e.target.value;apply()});

      renderSummary();
      apply();
    })();
  </script>
</body>
</html>
